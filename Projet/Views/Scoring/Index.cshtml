@model IEnumerable<Projet.Models.Offre>

@{
    ViewData["Title"] = "Lancer un Matching";
}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-7 col-lg-6">

            <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
                <div class="card-header border-0 py-5 text-center text-white"
                     style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="mb-3">
                        <i class="fas fa-robot fa-4x text-white opacity-75"></i>
                    </div>
                    <h2 class="fw-bold mb-1">Matching Intelligent</h2>
                    <p class="mb-0 opacity-75 font-monospace small">Algorithme de Scoring V1.0</p>
                </div>

                <div class="card-body p-5">

                    @if (Model.Any())
                    {
                        <div class="text-center mb-4">
                            <p class="text-muted">
                                Sélectionnez une offre d'emploi ci-dessous. Notre algorithme va analyser votre base de candidats pour trouver les meilleures correspondances.
                            </p>
                        </div>

                        <div class="form-floating mb-4">
                            <select id="offerSelect" class="form-select form-select-lg" onchange="updateLaunchButton()">
                                <option selected disabled value="">-- Choisir une offre --</option>
                                @foreach (var offre in Model)
                                {
                                    <option value="@offre.Id">@offre.Titre (@offre.Poste?.Intitule)</option>
                                }
                            </select>
                            <label for="offerSelect">Offre à analyser</label>
                        </div>

                        <div class="d-grid">
                            <a id="btnLaunch" href="#" class="btn btn-primary-gradient btn-lg py-3 disabled shadow-sm">
                                <span id="btnText">Sélectionnez une offre...</span>
                                <i class="fas fa-arrow-right ms-2"></i>
                            </a>
                        </div>

                        <div class="text-center mt-3">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                Le calcul prend en compte les compétences, l'expérience et la localisation.
                            </small>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-3">
                            <div class="text-warning mb-3"><i class="fas fa-exclamation-triangle fa-3x"></i></div>
                            <h4 class="fw-bold text-dark">Aucune offre disponible</h4>
                            <p class="text-muted mb-4">Vous devez créer au moins une offre d'emploi avant de lancer un matching.</p>
                            <a asp-controller="Offres" asp-action="Create" class="btn btn-outline-primary rounded-pill px-4">
                                <i class="fas fa-plus me-2"></i>Créer une offre maintenant
                            </a>
                        </div>
                    }

                </div>

                <div class="card-footer bg-light border-0 text-center py-3">
                    <a asp-controller="Home" asp-action="Index" class="text-decoration-none text-muted small fw-bold">
                        <i class="fas fa-times me-1"></i> Annuler et retour Dashboard
                    </a>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    function updateLaunchButton() {
        // 1. On récupère l'ID de l'offre choisie
        var selectBox = document.getElementById("offerSelect");
        var selectedId = selectBox.value;

        // 2. On cible le bouton et le texte
        var btn = document.getElementById("btnLaunch");
        var btnText = document.getElementById("btnText");

        if (selectedId) {
            // 3. Si une offre est choisie, on active le bouton et on construit l'URL
            // L'URL devient : /Scoring/Calculer/5
            btn.href = "/Scoring/Calculer/" + selectedId;

            // On change le style pour montrer que c'est prêt
            btn.classList.remove("disabled");
            btnText.innerText = "Lancer l'analyse maintenant";
        } else {
            // Sinon on désactive
            btn.classList.add("disabled");
            btnText.innerText = "Sélectionnez une offre...";
        }
    }
</script>